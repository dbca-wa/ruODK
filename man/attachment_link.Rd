% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/attachment_link.R
\name{attachment_link}
\alias{attachment_link}
\title{Prefix attachment columns from CSV export with a local attachment file path.}
\usage{
attachment_link(data_tbl, form_schema, att_path = "media")
}
\arguments{
\item{data_tbl}{The downloaded submissions from
\code{\link{submission_export}} read into a `tibble` by
\code{readr::read_csv}.}

\item{form_schema}{The `form_schema` for the submissions.
E.g. the output of `ruODK::form_schema()`.}

\item{att_path}{A local path, default: "media" (as per .csv.zip export).
Selected columns of the dataframe (containing attchment filenames) are
prefixed with `att_path`, thus turning them into relative paths.}
}
\value{
The dataframe with attachment columns modified to contain relative
  paths to the downloaded attachment files.
}
\description{
`r lifecycle::badge("stable")`
}
\examples{
\dontrun{
t <- tempdir()
# Set default credentials, see vignette "setup"
ruODK::ru_setup(
  svc = paste0(
    "https://sandbox.central.getodk.org/v1/projects/14/",
    "forms/build_Flora-Quadrat-0-2_1558575936.svc"
  ),
  un = "me@email.com",
  pw = "..."
)

# Predict filenames (with knowledge of form)
fid <- get_default_fid()
fid_csv <- fs::path(t, glue::glue("{fid}.csv"))
fid_csv_tae <- fs::path(t, glue::glue("{fid}-taxon_encounter.csv"))
fs <- form_schema()

# Download the zip file
se <- ruODK::submission_export(
  local_dir = t,
  overwrite = FALSE,
  verbose = TRUE
)

# Unpack the zip file
f <- unzip(se, exdir = t)
fs::dir_ls(t)

# Prepend attachments with media/ to turn into relative file paths
data_quadrat <- fid_csv \%>\%
  readr::read_csv(na = c("", "NA", "na")) \%>\%
  janitor::clean_names() \%>\%
  handle_ru_datetimes(fs) \%>\%
  attachment_link(fs)
}
}
\seealso{
Other utilities: 
\code{\link{attachment_get}()},
\code{\link{attachment_url}()},
\code{\link{drop_null_coords}()},
\code{\link{form_schema_parse}()},
\code{\link{get_one_attachment}()},
\code{\link{get_one_submission_attachment_list}()},
\code{\link{get_one_submission}()},
\code{\link{handle_ru_attachments}()},
\code{\link{handle_ru_datetimes}()},
\code{\link{handle_ru_geopoints}()},
\code{\link{handle_ru_geoshapes}()},
\code{\link{handle_ru_geotraces}()},
\code{\link{isodt_to_local}()},
\code{\link{odata_submission_rectangle}()},
\code{\link{predict_ruodk_name}()},
\code{\link{prepend_uuid}()},
\code{\link{ru_msg_abort}()},
\code{\link{ru_msg_info}()},
\code{\link{ru_msg_noop}()},
\code{\link{ru_msg_success}()},
\code{\link{ru_msg_warn}()},
\code{\link{split_geopoint}()},
\code{\link{split_geoshape}()},
\code{\link{split_geotrace}()},
\code{\link{strip_uuid}()},
\code{\link{tidyeval}},
\code{\link{unnest_all}()}
}
\concept{utilities}
